<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <!-- Meta viewport pour adapter la page au mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carte des mobilités</title>
  <!-- Feuille de style Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Styles de base pour bureau */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      font-size: 16px;
    }
    #container {
      display: flex;
      height: 100%;
      width: 100%;
    }
    #sidebar { 
      width: 300px;
      min-width: 200px;
      max-width: 400px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      padding: 10px;
      box-sizing: border-box;
    }
    #map {
      flex: 1;
    }
    h1 {
      margin-top: 0;
      font-size: 1.5rem;
    }
    .student-item {
      margin-bottom: 8px;
      cursor: pointer;
      padding: 6px;
      border: 1px solid #eee;
      border-radius: 4px;
      font-size: 1rem;
    }
    .student-item:hover {
      background-color: #f0f0f0;
    }
    .bw-animate {
      filter: grayscale(0%);
      transition: filter 2s ease-in-out;
    }
    .bw-animate.bw-active {
      filter: grayscale(100%);
    }
    
    /* Adaptation pour écrans mobiles - augmentation des tailles de texte */
    @media (max-width: 768px) {
      /* Passage en disposition colonne */
      #container {
        flex-direction: column;
      }
      /* Sidebar en haut sur toute la largeur avec texte agrandi */
      #sidebar {
        width: 100%;
        min-width: 100%;
        max-width: 100%;
        border-right: none;
        border-bottom: 1px solid #ccc;
        padding: 25px;
        font-size: 2.5rem !important;
      }
      /* Titre agrandi */
      h1 {
        font-size: 3rem !important;
      }
      /* Items de la sidebar très agrandis pour la lisibilité */
      .student-item {
        font-size: 2.5rem !important;
        padding: 15px;
      }
      /* La carte occupe le reste de l'écran */
      #map {
        width: 100%;
        height: 60vh;
      }
      /* Augmentation générale de la taille de la police pour tout le document */
      html, body {
        font-size: 24px !important;
      }
    }
  </style>
</head>

<body>
  <div id="container">
    <!-- SIDEBAR -->
    <div id="sidebar">
      <h1>Carte des élèves</h1>
      <div id="student-list"></div>
    </div>
    <!-- CARTE -->
    <div id="map"></div>
  </div>

  <!-- Scripts Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // === 1) Données des élèves ===
    // Informations des élèves avec coordonnées, image et description (texte formel)
    const students = [
      {
        name: "Axel",
        coords: [38.1157, 13.3615], // Palerme, Sicile
        photo: "Photos/Axel.png",
        details: "Condamné à une peine de 8 semaines d'incarcération à la Casa Circondariale Pagliarelli de Palerme, suite à son activité de 'stalking répété' contre des élèves de l'école maternelle de Scuola dell’Infanzia “Maria Montessori”."
      },
      {
        name: "Chris",
        coords: [48.5, 10.5], // Coordonnées fictives pour 86609 Donauworth
        photo: "Photos/Chris.png",
        details: "Coincé aux sanitaires suite à la consommation d'un plat typique (Käsespätzlezwiebelschmelzschmorgericht) dont les circonstances ont fait l'objet d'un examen réglementaire approfondi."
      },
      {
        name: "Raphael",
        coords: [47.65, 9.50], // Friedrichshafen
        photo: "Photos/Raphael.jpg",
        details: "M. Raphael a, dans le cadre d'un changement significatif d'apparence personnelle (rasage intégral du crâne), été mis en examen pour implication présumée dans la distribution de métamphétamine. Il aurait notamment déclaré aux autorités : 'Ich bin nicht in Danger. Ich bin die Danger.'"
      },
      {
        name: "Benjamin",
        coords: [33.94, -117.85], // Yorba Linda, CA
        photo: "Photos/Benjamin.jpg",
        details: "M. Benjamin, domicilié à Yorba Linda, a été interpellé par des agents ICE en civil alors qu’il se rendait à son travail. Son arrestation fait suite à la réception, par les autorités compétentes, de captures d’écran falsifiées et jointes à un signalement officiel par e-mail, laissant supposer une critique de la politique étrangère de l’État d’Israël. Il aurait depuis été transféré vers un centre de détention au Salvador."
      },
      {
        name: "Khalil",
        coords: [50.4547, 3.95], // Mons, Belgique
        photo: "Photos/Khalil.png",
        details: "Effectuant sa mobilité à 20 km de la frontière française, M. Khalil fait l'objet d'une mesure administrative dont les précisions sont en attente de confirmation par les autorités compétentes."
      },
      {
        name: "Patrice",
        coords: [35.6895, 139.6917], // Tokyo
        photo: "Photos/Patrice.png",
        details: "M. Patrice, en mobilité à l'Université de Tokyo, a indiqué, sur avis formel de son conseil juridique, qu'il s'abstiendrait de procéder à la communication initialement prévue, en raison des recommandations exprimées par son avocat compte tenu des implications légales et éthiques."
      },
      // Exemples précédents
      {
        name: "Thomas",
        coords: [37.04390331027527, -7.971833235811672],
        photo: "Photos/Thomas.jpg",
        details: "A investi 7850€ pour concrétiser sa mobilité et a soumis sa convention avec un léger retard, compromettant ainsi l'accès aux aides prévues."
      },
      {
        name: "Thibault",
        coords: [12.9620, 77.5698],
        photo: "Photos/Thibaut.png",
        details: "Suite à des complications administratives, la situation de M. Thibault a été revue conformément aux dispositions en vigueur."
      },
      {
        name: "Gabriel",
        coords: [40.4168, -3.7038],
        photo: "Photos/Gabriel.png",
        details: "Cas traité suivant l'incident impliquant un véhicule de modèle Dacia Sandero 2015 survenu le 16 mai 2025, dans le cadre des procédures en vigueur."
      }
    ];

    // === 2) Initialisation de la carte Leaflet ===
    const map = L.map('map').setView([20, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Stockage des marqueurs
    const markers = [];

    // === 3) Création des marqueurs et construction de la sidebar ===
    const studentListDiv = document.getElementById('student-list');

    students.forEach((student, index) => {
      const isSpecialAnimation = student.name === 'Gabriel'; // Exemple d'animation spécifique (adaptable)
      const marker = L.marker(student.coords).addTo(map)
        .bindPopup(`
          <b>${student.name}</b><br/>
          <img 
            src="${student.photo}" 
            class="${isSpecialAnimation ? 'bw-animate' : ''}" 
            id="photo-${index}"
            style="width: 150px; border-radius: 6px; margin: 5px 0;" 
            alt="${student.name}"><br/>
          ${student.details}
        `);

      markers.push(marker);

      const studentItem = document.createElement('div');
      studentItem.className = 'student-item';
      studentItem.innerHTML = `<strong>${student.name}</strong>`;
      
      studentItem.addEventListener('click', () => {
        map.flyTo(student.coords, 10);
        setTimeout(() => {
          marker.openPopup();
          if (student.name === "Gabriel") {
            setTimeout(() => {
              const photo = document.getElementById("photo-" + index);
              if (photo) {
                photo.classList.add("bw-active");
              }
            }, 300);
          }
        }, 800);
      });

      studentListDiv.appendChild(studentItem);
    });
  </script>
</body>
</html>
